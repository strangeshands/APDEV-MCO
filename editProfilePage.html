<!DOCTYPE html>
<html>
     <head>
          <title> [username] - Edit Profile </title>
          <link rel="stylesheet" type="text/css" href="editProfile.css">
          <link rel="icon" href="resources/Logo.svg" type="image/svg+xml">

          <!-- CROPPER -->
          <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
          <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

          <!-- PROFILE DATA -->
          <script src="profile1-data.js"></script>
     </head>
     <body>
          <header>
               <div id="headercol1">
                    <img id="logo" src="resources/Logo.svg" />
                    <p id="appName"> Connectify </p>
               </div>
               <div id="headercol2">
                    <div id="search-bar" class="searchBar">
                         <img src="resources/Trailing-Elements.svg" alt="Search Icon">
                         <input type="text" id="search" name="search" placeholder="Search #tags or ::words::" required>
                    </div>
               </div>
          </header>

          <div id="base">

               <!-- OPTIONS -->
               <div id="col1" class="base-columns">
                    <div class="col1-sub-container">
                         <button class="discard" onclick="window.location.href='profilePage.html'">
                              Discard Changes
                         </button>

                         <div id="button-brk" class="inviBrk"></div>

                         <button class="save" onclick="window.location.href='profilePage.html'">
                              Save
                         </button>
                    </div>

                    <div class="col1-sub-container"> 
                         <button class="delete-account">
                              Delete Account
                         </button>
                    </div>
               </div>

               <div class="column-brk"></div>

               <div id="col2" class="base-columns">
                    <div class="col2-row">
                         <div class="col1-row1-col">
                              <div id="pfpcontainer">
                                   <div id="pfpPic">
                                        <img src="" />
                                   </div>
                              </div>

                              <button id="change-pfp" class ="change-photo">
                                   Change Profile Photo
                              </button>
                         </div>

                         <div class="col1-row1-col">
                              <div id="profileHeader">
                                   <img src="" />
                              </div>
                              <button id="change-header" class="change-photo">
                                   Change Header
                              </button>
                         </div>
                    </div>

                    <!-- INPUT for images -->
                    <input type="file" id="image-input" accept="image/*" style="display: none;" />

                    <!-- MODAL FOR IMAGE CROPPING -->
                    <div id="crop-modal" style="display: none;">
                         <div>
                             <h2>Adjust Your Image</h2>
                             <div>
                                 <img id="crop-image" />
                             </div>
                             <button id="crop-save-btn">Save</button>
                             <button id="crop-cancel-btn">Cancel</button>
                         </div>
                    </div>

                    <div class="row-brk" style="width: inherit;"></div>

                    <div id="input-details" class="col2-row">
                         <div class="input-segment-rows">
                              <div class="input-col">
                                   <div id="change-username" class="input-fields">
                                        <p class="input-label"> Username </p>
                                        <input type="text" id="username" name="username" placeholder="New username">
                                        <label id="username-feedback" class="input-feedback">insert feedback</label>
                                   </div>
                                   <div id="change-display-name" class="input-fields">
                                        <p class="input-label"> Display Name </p>
                                        <input type="text" id="display-name" name="display-name" placeholder="New display name">
                                        <label id="dn-feedback" class="input-feedback">insert feedback</label>
                                   </div>
                              </div>

                              <div class="input-col">
                                   <div id="change-bio" class="input-fields">
                                        <p class="input-label"> Bio </p>
                                        <textarea id="bio" name="bio" rows="5" cols="80" placeholder="New bio..."></textarea>
                                   </div>
                              </div>
                         </div>

                         <div class="input-segment-rows button-row">
                              <button id="save-changes" class="save-buttons">
                                   Save Changes
                              </button>
                         </div>

                         <div class="row-brk"></div>

                         <div class="input-segment-rows">
                              <div class="input-col">
                                   <label> Account Information </label>
                                   <div id="change-email" class="input-fields">
                                        <p class="input-label"> Email </p>
                                        <input type="email" id="email" name="email" placeholder="New email">
                                        <label id="email-feedback" class="input-feedback">insert feedback</label>
                                   </div>
                                   <div id="change-ematelil" class="input-fields">
                                        <p class="input-label"> Phone Number </p>
                                        <input type="tel" id="tel-number" name="tel-number" placeholder="New number">
                                        <label id="tel-feedback" class="input-feedback">insert feedback</label>
                                   </div>

                                   <div class="button-row">
                                        <button id="update-acc" class="save-buttons">
                                             Update Account
                                        </button>
                                   </div>
                              </div>

                              <div class="input-col">
                                   <label> Change Password </label>
                                   <div id="password-edit">
                                        <div id="current-password" class="input-fields password-edit">
                                             <p class="input-label"> Current Password </p>
                                             <input type="password" id="current-password" name="password" placeholder="Current password">
                                        </div>
                                        <div id="change-password" class="input-fields password-edit">
                                             <p class="input-label"> New Password </p>
                                             <input type="password" id="password" name="passsword" placeholder="New password">
                                             <label id="pw-feedback" class="input-feedback">insert feedback</label>
                                        </div>
                                        <div id="confirm-password" class="input-fields password-edit">
                                             <p class="input-label"> Confirm New Password </p>
                                             <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirm password">
                                        </div>
                                   </div>
                                   <button id="update-pw" class="save-buttons" style:>
                                        Update Password
                                   </button>
                              </div>
                         </div>

                         <!--<div class="input-col">
                              <div id="change-email" class="input-fields">
                                   <p class="input-label"> Email </p>
                                   <input type="email" id="email" name="email" placeholder="New email">
                              </div>
                         </div>

                         <div class="column-brk" style="height: 40vh"></div>

                         <div class="input-col">
                              <label> Change Password </label>
                              <div id="password-edit">
                                   <div id="current-password" class="input-fields password-edit">
                                        <p class="input-label"> Current Password </p>
                                        <input type="password" id="current-password" name="password" placeholder="Current password">
                                   </div>
                                   <div id="change-password" class="input-fields password-edit">
                                        <p class="input-label"> New Password </p>
                                        <input type="password" id="password" name="passsword" placeholder="New password">
                                   </div>
                                   <div id="confirm-password" class="input-fields password-edit">
                                        <p class="input-label"> Confirm New Password </p>
                                        <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirm password">
                                   </div>
                              </div>
                         </div>-->
                    </div>
               </div>
               
          </div>
     </body>
</html>

<!-- JAVASCRIPT -->
<script>
     /* --- LOADER --- */
     document.addEventListener("DOMContentLoaded", () => {
          const headerImage = document.querySelector("#profileHeader img");
          const pfpImage = document.querySelector("#pfpPic img");

          /* SET IMAGES */
          headerImage.src = profile1.header;
          pfpImage.src = profile1.pfp;
     });

     const changeHeaderBtn = document.getElementById("change-header");
     const changeProfilePicBtn = document.getElementById("change-pfp");
     const imageInput = document.getElementById("image-input");
     const cropModal = document.getElementById("crop-modal");
     const cropImage = document.getElementById("crop-image");
     const cropSaveBtn = document.getElementById("crop-save-btn");
     const cropCancelBtn = document.getElementById("crop-cancel-btn");

     let currentContext = "";
     let cropper;

     changeHeaderBtn.addEventListener("click", () => {
          currentContext = "header";
          imageInput.click(); 
     });

     changeProfilePicBtn.addEventListener("click", () => {
          currentContext = "profile";
          imageInput.click(); 
     });

     imageInput.addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (file) {
               const reader = new FileReader();
               reader.onload = () => {
                    cropImage.src = reader.result;
                    cropModal.style.display = "block"; 

                    // Initialize or replace Cropper.js
                    if (cropper) cropper.destroy();
                    cropper = new Cropper(cropImage, {
                         aspectRatio: currentContext === "profile" ? 1 : 850 / 210,
                         viewMode: 1,
                         autoCropArea: 1,
                    });
               };
               reader.readAsDataURL(file);
          }
     });

     // Save cropped image
     cropSaveBtn.addEventListener("click", () => {
     const canvas = cropper.getCroppedCanvas({
          width: currentContext === "profile" ? 200 : 1600,
          height: currentContext === "profile" ? 200 : 900,
     });

     // Convert the cropped image to a data URL
     const croppedImageURL = canvas.toDataURL("image/png");

     // Replace the header or profile picture with the cropped image
     if (currentContext === "profile") {
          const pfpImage = document.querySelector("#pfpPic img");
          pfpImage.src = croppedImageURL; 

          // Update profile1
          profile1.pfp = croppedImageURL; 
     } else if (currentContext === "header") {
          const headerImage = document.querySelector("#profileHeader img");
          headerImage.src = croppedImageURL; 

          // Update profile1
          profile1.header = croppedImageURL; 
     }

     // Close the modal
     cropModal.style.display = "none";
          cropper.destroy();
          cropper = null;
          imageInput.value = "";
     });

     // Cancel cropping
     cropCancelBtn.addEventListener("click", () => {
          cropModal.style.display = "none";
          cropper.destroy();
          cropper = null;
          imageInput.value = "";
     });
</script>