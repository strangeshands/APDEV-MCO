<!DOCTYPE html>
<html>
    <head>
        <title>Connectify - Post</title>
        <link rel="icon" href="resources/Logo.svg" type="image/svg+xml">
        <link rel="stylesheet" type="text/css" href="postPage.css">
    </head>
    <body>
          <header>
               <div id="headercol1">
                    <img id="logo" src="resources/Logo.svg" />
                    <p id="appName"> Connectify </p>
               </div>
               <div id="headercol2">
                    <div class="searchBar">
                         <img src="resources/Trailing-Elements.svg" alt="Search Icon">
                         <input type="text" id="search" name="search" placeholder="Search #tags or ::words::" required>
                    </div>
          
                    <!-- IF USER IS NOT LOGGED IN -->
                    <button id="logInButton" onclick="window.location.href='loginPage.html'">Log In</button>
               </div>
          </header>
        
        <main>
            <div class="goBackLink" onclick="window.location.href='homePage.html'">
                <span class="arrow">&#8604;</span>
                <span class="back">Back</span>
            </div>

            <div id="post">
                <div class="postHeader">
                    <div class="userInfo">
                        <div class="avatar" id="postAvatar"></div>
                        <div class="username-and-time">
                            <div class="username" id="postUsername">Username</div>
                            <div class="time" id="postTime">4 hours ago</div>
                        </div>
                    </div>
                    <!-- IF POST BELONGS TO USER
                    <button class="optionsButton" id="postOptions">
                        <img src="resources/Options Button.svg" alt="Options">
                    </button> -->
                </div>
                <div id="tags">
                    <a href="">#funny</a>
                    <a href="">#life</a>
                </div>
                <div id="postTitle">
                    This is a title
                </div>
                <div id="postText">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin ac tortor sed velit luctus malesuada. Aenean suscipit, arcu et pulvinar tincidunt, lorem felis tempor quam, sed euismod turpis neque et lorem. Fusce id libero ut nulla fringilla interdum. Curabitur posuere metus non nibh.
                </div>

                <div id="postImageContainer">
                </div>

                 <div class="postActions">
                        <button id="heart" class="actionButton">
                            <img src="resources/Heart.svg"/>
                            <span class="counter">1.5k</span>
                    </button>
                    <img src="resources/Line.svg" alt="Line">
                    <button id="heartCrack" class="actionButton">
                            <img src="resources/HeartCrack.svg"/>
                            <span class="counter">21</span>
                    </button>
                    <button class="actionButton"onclick="window.location.href='replyPage.html'">
                            <img src="resources/Comments.svg"/>
                    </button>
                    <button id="bookmark" class="actionButton">
                            <img src="resources/bookmark.svg"/>
                    </button>
                 </div>
            </div>

            <div id="comments">
                <h2>Comments</h2>
                <div class="horizontalBar"></div>
                <div class="comment-thread">
                    <div class="comment">
                        <div class="postHeader">
                            <div class="userInfo">
                                <div class="avatar">A</div>
                                <div class="username-and-time">
                                    <div class="username">Username</div>
                                    <div class="time">4 hours ago</div>
                                </div>
                            </div>
                            <!-- IF COMMENT BELONGS TO USER
                            <button class="optionsButton">
                                <img src="resources/Options Button.svg" alt="Options">
                            </button> -->
                        </div>
                        <div class="commentText">
                            Good morning!
                        </div>

                        <div class="commentActions">
                                <button id="heart" class="actionButton">
                                    <img src="resources/Heart.svg"/>
                                    <span class="counter">42</span>
                            </button>
                            <img src="resources/Line.svg" alt="Line">
                            <button id="heartCrack" class="actionButton">
                                    <img src="resources/HeartCrack.svg"/>
                                    <span class="counter">42</span>
                            </button>
                            <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                <img src="resources/Comments.svg"/>
                            </button>
                            <button id="bookmark" class="actionButton">
                                    <img src="resources/bookmark.svg"/>
                            </button>
                        </div>
            
                        <div class="nestedCommentsContainer">
                            <div class="nestedCommentTrigger">
                                <div class="nestedCommentLine"></div>
                                <button class="viewRepliesButton">View Replies (2)</button>
                            </div>
            
                            <div class="nestedComments">
                                <div class="comment nested-level-1">
                                    <div class="postHeader">
                                        <div class="userInfo">
                                            <div class="avatar">B</div>
                                            <div class="username-and-time">
                                                <div class="usernames">
                                                    <span class="username">Replier Name</span>
                                                    <span class="replyTo">in reply to @Username</span>
                                                </div>
                                                <div class="time">3 hours ago</div>
                                            </div>
                                        </div>
                                        <!-- IF COMMENT BELONGS TO USER
                                        <button class="optionsButton">
                                             <img src="resources/Options Button.svg" alt="Options">
                                        </button> -->
                                    </div>
                                    <div class="commentText">
                                        Helloooo
                                    </div>

                                    <div class="commentActions">
                                            <button id="heart" class="actionButton">
                                                <img src="resources/Heart.svg"/>
                                                <span class="counter">32</span>
                                        </button>
                                        <img src="resources/Line.svg" alt="Line">
                                        <button id="heartCrack" class="actionButton">
                                                <img src="resources/HeartCrack.svg"/>
                                                <span class="counter">12</span>
                                        </button>
                                        <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                            <img src="resources/Comments.svg"/>
                                        </button>
                                        <button id="bookmark" class="actionButton">
                                                <img src="resources/bookmark.svg"/>
                                        </button>
                                    </div>
            
                                    <div class="nestedCommentsContainer">
                                        <div class="nestedCommentTrigger">
                                            <div class="nestedCommentLine"></div>
                                            <button class="viewRepliesButton">View Replies (1)</button>
                                        </div>
            
                                        <div class="nestedComments">
                                            <div class="comment nested-level-2">
                                                <div class="postHeader">
                                                    <div class="userInfo">
                                                        <div class="avatar">C</div>
                                                        <div class="username-and-time">
                                                            <div class="usernames">
                                                                <span class="username">Another Replier</span>
                                                                <span class="replyTo">in reply to @Replier Name</span>
                                                            </div>
                                                            <div class="time">2 hours ago</div>
                                                        </div>
                                                    </div>
                                                    <!-- IF COMMENT BELONGS TO USER
                                                       <button class="optionsButton">
                                                            <img src="resources/Options Button.svg" alt="Options">
                                                       </button> -->
                                                </div>
                                                <div class="commentText">
                                                    Bye.
                                                </div>
                                                <div class="commentActions">
                                                    <button id="heart" class="actionButton">
                                                        <img src="resources/Heart.svg"/>
                                                        <span class="counter">42</span>
                                                    </button>
                                                    <img src="resources/Line.svg" alt="Line">
                                                    <button id="heartCrack" class="actionButton">
                                                            <img src="resources/HeartCrack.svg"/>
                                                            <span class="counter">42</span>
                                                    </button>
                                                    <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                                        <img src="resources/Comments.svg"/>
                                                    </button>
                                                    <button id="bookmark" class="actionButton">
                                                            <img src="resources/bookmark.svg"/>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="comment nested-level-1">
                                    <div class="postHeader">
                                        <div class="userInfo">
                                            <div class="avatar">B</div>
                                            <div class="username-and-time">
                                                <div class="usernames">
                                                    <span class="username">Replier Name</span>
                                                    <span class="replyTo">in reply to @Username</span>
                                                </div>
                                                <div class="time">3 hours ago</div>
                                            </div>
                                        </div>
                                        <!-- IF COMMENT BELONGS TO USER
                                        <button class="optionsButton">
                                             <img src="resources/Options Button.svg" alt="Options">
                                        </button> -->
                                    </div>
                                    <div class="commentText">
                                        Good morning to you to :)
                                    </div>
                                    <div class="commentActions">
                                        <button id="heart" class="actionButton">
                                            <img src="resources/Heart.svg"/>
                                            <span class="counter">20</span>
                                        </button>
                                        <img src="resources/Line.svg" alt="Line">
                                        <button id="heartCrack" class="actionButton">
                                            <img src="resources/HeartCrack.svg"/>
                                            <span class="counter">17</span>
                                        </button>
                                        <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                             <img src="resources/Comments.svg"/>
                                        </button>
                                        <button id="bookmark" class="actionButton">
                                            <img src="resources/bookmark.svg"/>
                                        </button>
                                   </div>
                                    <div class="nestedCommentsContainer">
                                        <div class="nestedCommentTrigger">
                                            <div class="nestedCommentLine"></div>
                                            <button class="viewRepliesButton">View Replies (1)</button>
                                        </div>
            
                                        <div class="nestedComments">
                                            <div class="comment nested-level-2">
                                                <div class="postHeader">
                                                    <div class="userInfo">
                                                        <div class="avatar">C</div>
                                                        <div class="username-and-time">
                                                            <div class="usernames">
                                                                <span class="username">Another Replier</span>
                                                                <span class="replyTo">in reply to @Replier Name</span>
                                                            </div>
                                                            <div class="time">2 hours ago</div>
                                                        </div>
                                                    </div>
                                                    <!-- IF COMMENT BELONGS TO USER
                                                       <button class="optionsButton">
                                                            <img src="resources/Options Button.svg" alt="Options">
                                                       </button> -->
                                                </div>
                                                <div class="commentText">
                                                    *too lol &#x1F602;
                                                </div>
                                                <div class="commentActions">
                                                       <button id="heart" class="actionButton">
                                                            <img src="resources/Heart.svg"/>
                                                            <span class="counter">2</span>
                                                       </button>
                                                       <img src="resources/Line.svg" alt="Line">
                                                       <button id="heartCrack" class="actionButton">
                                                            <img src="resources/HeartCrack.svg"/>
                                                            <span class="counter">2</span>
                                                       </button>
                                                       <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                                            <img src="resources/Comments.svg"/>
                                                       </button>
                                                       <button id="bookmark" class="actionButton">
                                                            <img src="resources/bookmark.svg"/>
                                                       </button>
                                                  </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>   
                    </div>
                    <div class="comment">
                        <div class="postHeader">
                            <div class="userInfo">
                                <div class="avatar">A</div>
                                <div class="username-and-time">
                                    <div class="username">Username</div>
                                    <div class="time">4 hours ago</div>
                                </div>
                            </div>
                            <!-- IF COMMENT BELONGS TO USER
                            <button class="optionsButton">
                                <img src="resources/Options Button.svg" alt="Options">
                            </button> -->
                        </div>
                        <div class="commentText">
                            I love this
                        </div>
                        <div class="commentActions">
                              <button id="heart" class="actionButton">
                                   <img src="resources/Heart.svg"/>
                                   <span class="counter">10</span>
                              </button>
                              <img src="resources/Line.svg" alt="Line">
                              <button id="heartCrack" class="actionButton">
                                   <img src="resources/HeartCrack.svg"/>
                                   <span class="counter">0</span>
                              </button>
                              <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                   <img src="resources/Comments.svg"/>
                              </button>
                              <button id="bookmark" class="actionButton">
                                   <img src="resources/bookmark.svg"/>
                              </button>
                         </div>
            
                        <div class="nestedCommentsContainer">
                            <div class="nestedCommentTrigger">
                                <div class="nestedCommentLine"></div>
                                <button class="viewRepliesButton">View Replies (1)</button>
                            </div>
            
                            <div class="nestedComments">
                                <div class="comment nested-level-1">
                                    <div class="postHeader">
                                        <div class="userInfo">
                                            <div class="avatar">B</div>
                                            <div class="username-and-time">
                                                <div class="usernames">
                                                    <span class="username">Replier Name</span>
                                                    <span class="replyTo">in reply to @Username</span>
                                                </div>
                                                <div class="time">3 hours ago</div>
                                            </div>
                                        </div>
                                        <!-- IF COMMENT BELONGS TO USER
                                        <button class="optionsButton">
                                             <img src="resources/Options Button.svg" alt="Options">
                                        </button> -->
                                    </div>
                                    <div class="commentText">
                                        I love you more
                                    </div>
                                    <div class="commentActions">
                                        <button id="heart" class="actionButton">
                                            <img src="resources/Heart.svg"/>
                                            <span class="counter">10</span>
                                        </button>
                                        <img src="resources/Line.svg" alt="Line">
                                        <button id="heartCrack" class="actionButton">
                                             <img src="resources/HeartCrack.svg"/>
                                             <span class="counter">1</span>
                                        </button>
                                        <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                             <img src="resources/Comments.svg"/>
                                        </button>
                                        <button id="bookmark" class="actionButton">
                                             <img src="resources/bookmark.svg"/>
                                        </button>
                                   </div>
            
                                    <div class="nestedCommentsContainer">
                                        <div class="nestedCommentTrigger">
                                            <div class="nestedCommentLine"></div>
                                            <button class="viewRepliesButton">View Replies (1)</button>
                                        </div>
            
                                        <div class="nestedComments">
                                            <div class="comment nested-level-2">
                                                <div class="postHeader">
                                                    <div class="userInfo">
                                                        <div class="avatar">C</div>
                                                        <div class="username-and-time">
                                                            <div class="usernames">
                                                                <span class="username">Another Replier</span>
                                                                <span class="replyTo">in reply to @Replier Name</span>
                                                            </div>
                                                            <div class="time">2 hours ago</div>
                                                        </div>
                                                    </div>
                                                    <!-- IF COMMENT BELONGS TO USER
                                                       <button class="optionsButton">
                                                            <img src="resources/Options Button.svg" alt="Options">
                                                       </button> -->
                                                </div>
                                                <div class="commentText">
                                                    :0
                                                </div>
                                                <div class="commentActions">
                                                  <button id="heart" class="actionButton">
                                                      <img src="resources/Heart.svg"/>
                                                      <span class="counter">100</span>
                                                  </button>
                                                  <img src="resources/Line.svg" alt="Line">
                                                  <button id="heartCrack" class="actionButton">
                                                       <img src="resources/HeartCrack.svg"/>
                                                       <span class="counter">20</span>
                                                  </button>
                                                  <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                                       <img src="resources/Comments.svg"/>
                                                  </button>
                                                  <button id="bookmark" class="actionButton">
                                                       <img src="resources/bookmark.svg"/>
                                                  </button>
                                             </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>   
                    </div>
                    <div class="comment">
                        <div class="postHeader">
                            <div class="userInfo">
                                <div class="avatar">A</div>
                                <div class="username-and-time">
                                    <div class="username">Username</div>
                                    <div class="time">4 hours ago</div>
                                </div>
                            </div>
                            <!-- IF COMMENT BELONGS TO USER
                            <button class="optionsButton">
                                <img src="resources/Options Button.svg" alt="Options">
                            </button> -->
                        </div>
                        <div class="commentText">
                            Not connected but I have an exam today...
                        </div>
                        <div class="commentActions">
                              <button id="heart" class="actionButton">
                                   <img src="resources/Heart.svg"/>
                                   <span class="counter">10</span>
                              </button>
                              <img src="resources/Line.svg" alt="Line">
                              <button id="heartCrack" class="actionButton">
                                   <img src="resources/HeartCrack.svg"/>
                                   <span class="counter">99</span>
                              </button>
                              <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                   <img src="resources/Comments.svg"/>
                              </button>
                              <button id="bookmark" class="actionButton">
                                   <img src="resources/bookmark.svg"/>
                              </button>
                         </div>
                    </div>
                </div>
            </div>
        </main>

        <script src="nestedComments.js"></script>
        <script src="receivingPostData.js"></script>
        <script src="sendingPostData.js"></script>
    </body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('.actionButton').forEach(button => {
               button.addEventListener('click', function () {
                    const id = this.id; 
                    iconClicked(this, id);
                    console.log(id);
               });
          });
     });

    function iconClicked(button, iconType) {
          // Get the image within the button
          const img = button.querySelector('img');

          // Get the counter element if it exists
          const counter = button.querySelector('.counter');

          // Find the parent post or comment
          const post = button.closest('.postActions, .nestedComments, .comment');
          
          // Path for different icon types
          const iconPaths = {
               'heart': {
               default: 'resources/Heart.svg',
               clicked: 'resources/Heart-Clicked.svg'
               },
               'heartCrack': {
               default: 'resources/HeartCrack.svg',
               clicked: 'resources/HeartCrack-Clicked.svg'
               },
               'bookmark': {
               default: 'resources/Bookmark.svg',
               clicked: 'resources/Bookmark-Clicked.svg'
               }
          };

          if (iconType === 'heart' || iconType === 'heartCrack') {
               // Find like and dislike buttons
               const likeButton = post.querySelector('.actionButton img[src*="Heart"]').closest('.actionButton');
               const dislikeButton = post.querySelector('.actionButton img[src*="HeartCrack"]').closest('.actionButton');
               
               // Get like and dislike counters
               const likeCounter = likeButton.querySelector('.counter');
               const dislikeCounter = dislikeButton.querySelector('.counter');

               // Determine current button details
               const currentButton = iconType === 'heart' ? likeButton : dislikeButton;
               const otherButton = iconType === 'heart' ? dislikeButton : likeButton;
               const currentImg = currentButton.querySelector('img');
               const otherImg = otherButton.querySelector('img');
               const currentCounter = iconType === 'heart' ? likeCounter : dislikeCounter;
               const otherCounter = iconType === 'heart' ? dislikeCounter : likeCounter;

               // Normalize the current image's src path to ensure comparison works
               const currentSrc = currentImg.src.split('/').pop(); // Extract only the filename
               const isCurrentlyClicked = currentSrc === iconPaths[iconType].clicked.split('/').pop();

               // Check the other button's state
               const otherSrc = otherImg.src.split('/').pop();
               const isOtherClicked = otherSrc === iconPaths[iconType === 'heart' ? 'heartCrack' : 'heart'].clicked.split('/').pop();

               // Toggle current button state
               if (isCurrentlyClicked) {
                    // If already clicked, reset (unlike/undislike)
                    currentImg.src = iconPaths[iconType].default;
                    currentCounter.textContent = Math.max(0, parseInt(currentCounter.textContent) - 1);
               } else {
                    // If not clicked, set current button to clicked state
                    currentImg.src = iconPaths[iconType].clicked;
                    currentCounter.textContent = parseInt(currentCounter.textContent) + 1;

                    // If the other button was clicked, reset it
                    if (isOtherClicked) {
                         otherImg.src = iconPaths[iconType === 'heart' ? 'heartCrack' : 'heart'].default;
                         otherCounter.textContent = Math.max(0, parseInt(otherCounter.textContent) - 1);
                    }
               }
          } else if (iconType === 'bookmark') {
               // Bookmark button logic
               const currentSrc = img.src.split('/').pop(); // Extract only the filename
               const isCurrentlyBookmarked = currentSrc === iconPaths.bookmark.clicked.split('/').pop();

               // Toggle bookmark state
               if (isCurrentlyBookmarked) {
                    img.src = iconPaths.bookmark.default;
               } else {
                    img.src = iconPaths.bookmark.clicked;
               }
          }
     }
</script>