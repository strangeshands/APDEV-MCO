<!DOCTYPE html>
<html>
    <head>
        <title>Connectify - Post</title>
        <link rel="icon" href="resources/Logo.svg" type="image/svg+xml">
        <link rel="stylesheet" type="text/css" href="postPage.css">
    </head>
    <body>
          <header>
               <div id="headercol1" onclick="window.location.href='homePage.html'">
                    <img id="logo" src="resources/Logo.svg" />
                    <p id="appName"> Connectify </p>
               </div>
               <div id="headercol2">
                    <div class="searchBar">
                         <img src="resources/Trailing-Elements.svg" alt="Search Icon">
                         <input type="text" id="search" name="search" placeholder="Search #tags or ::words::" required>
                    </div>
          
                    <!-- IF USER IS NOT LOGGED IN -->
                    <button id="logInButton" onclick="window.location.href='loginPage.html'">Log In</button>
               </div>
          </header>

          <div class="break"> </div>
        
        <main>
            <div class="goBackLink" onclick="window.location.href='postPage.html'">
                <span class="arrow">&#8604;</span>
                <span class="back">Back</span>
            </div>

            <div id="post">
                <div class="postHeader">
                    <div class="userInfo">
                        <div class="avatar" id="postAvatar"></div>
                        <div class="username-and-time">
                            <div class="username" id="postUsername">Username</div>
                            <div class="time" id="postTime">4 hours ago</div>
                        </div>
                    </div>
                    <!-- IF POST BELONGS TO USER
                    <button class="optionsButton" id="postOptions">
                        <img src="resources/Options Button.svg" alt="Options">
                    </button> -->
                </div>

                <div id="postText">
                    Good morning!
                </div>

                 <div class="postActions">
                        <button id="heart" class="actionButton">
                            <img src="resources/Heart.svg"/>
                            <span class="counter">1500</span>
                    </button>
                    <img src="resources/Line.svg" alt="Line">
                    <button id="heartCrack" class="actionButton">
                            <img src="resources/HeartCrack.svg"/>
                            <span class="counter">21</span>
                    </button>
                    <button class="actionButton"onclick="window.location.href='replyPage.html'">
                            <img src="resources/Comments.svg"/>
                    </button>
                    <button id="bookmark" class="actionButton">
                            <img src="resources/bookmark.svg"/>
                    </button>
                 </div>
            </div>

            <div id="comments">
                <h2>Comments</h2>
                <div class="horizontalBar"></div>
                <div class="comment-thread">
                    <div class="comment">
                        <div class="postHeader">
                            <div class="userInfo">
                                <div class="avatar">A</div>
                                <div class="username-and-time">
                                    <div class="username">Username</div>
                                    <div class="time">4 hours ago</div>
                                </div>
                            </div>
                            <!-- IF COMMENT BELONGS TO USER
                            <button class="optionsButton">
                                <img src="resources/Options Button.svg" alt="Options">
                            </button> -->
                        </div>
                        <div class="commentText">
                            Hello!
                        </div>

                        <div class="commentActions">
                                <button id="heart" class="actionButton">
                                    <img src="resources/Heart.svg"/>
                                    <span class="counter">42</span>
                            </button>
                            <img src="resources/Line.svg" alt="Line">
                            <button id="heartCrack" class="actionButton">
                                    <img src="resources/HeartCrack.svg"/>
                                    <span class="counter">42</span>
                            </button>
                            <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                <img src="resources/Comments.svg"/>
                            </button>
                            <button id="bookmark" class="actionButton">
                                    <img src="resources/bookmark.svg"/>
                            </button>
                        </div>
            
                        <a href="postPage.html" class="viewRepliesLink">
                            <div class="replyIndicator">
                                <div class="replyLine"></div>
                                <span class="replyCount">View replies (2)</span>
                            </div>
                        </a>
                         
                    </div>
                    <div class="comment">
                        <div class="postHeader">
                            <div class="userInfo">
                                <div class="avatar">A</div>
                                <div class="username-and-time">
                                    <div class="username">Username</div>
                                    <div class="time">4 hours ago</div>
                                </div>
                            </div>
                            <!-- IF COMMENT BELONGS TO USER
                            <button class="optionsButton">
                                <img src="resources/Options Button.svg" alt="Options">
                            </button> -->
                        </div>
                        <div class="commentText">
                            &#9788;
                        </div>
                        <div class="commentActions">
                              <button id="heart" class="actionButton">
                                   <img src="resources/Heart.svg"/>
                                   <span class="counter">10</span>
                              </button>
                              <img src="resources/Line.svg" alt="Line">
                              <button id="heartCrack" class="actionButton">
                                   <img src="resources/HeartCrack.svg"/>
                                   <span class="counter">0</span>
                              </button>
                              <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                   <img src="resources/Comments.svg"/>
                              </button>
                              <button id="bookmark" class="actionButton">
                                   <img src="resources/bookmark.svg"/>
                              </button>
                         </div>
            
                         <a href="postPage.html" class="viewRepliesLink">
                            <div class="replyIndicator">
                                <div class="replyLine"></div>
                                <span class="replyCount">View replies (1)</span>
                            </div>
                        </a>  

                    </div>
                    <div class="comment">
                        <div class="postHeader">
                            <div class="userInfo">
                                <div class="avatar">A</div>
                                <div class="username-and-time">
                                    <div class="username">Username</div>
                                    <div class="time">4 hours ago</div>
                                </div>
                            </div>
                            <!-- IF COMMENT BELONGS TO USER
                            <button class="optionsButton">
                                <img src="resources/Options Button.svg" alt="Options">
                            </button> -->
                        </div>
                        <div class="commentText">
                            Not connected but I have an exam today again.....
                        </div>
                        <div class="commentActions">
                              <button id="heart" class="actionButton">
                                   <img src="resources/Heart.svg"/>
                                   <span class="counter">10</span>
                              </button>
                              <img src="resources/Line.svg" alt="Line">
                              <button id="heartCrack" class="actionButton">
                                   <img src="resources/HeartCrack.svg"/>
                                   <span class="counter">99</span>
                              </button>
                              <button class="actionButton"onclick="window.location.href='replyPage.html'">
                                   <img src="resources/Comments.svg"/>
                              </button>
                              <button id="bookmark" class="actionButton">
                                   <img src="resources/bookmark.svg"/>
                              </button>
                         </div>
                    </div>
                </div>
            </div>
        </main>
    </body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('.actionButton').forEach(button => {
               button.addEventListener('click', function () {
                    const id = this.id; 
                    iconClicked(this, id);
                    console.log(id);
               });
          });
     });

    function iconClicked(button, iconType) {
          // Get the image within the button
          const img = button.querySelector('img');

          // Get the counter element if it exists
          const counter = button.querySelector('.counter');

          // Find the parent post or comment
          const post = button.closest('.postActions, .nestedComments, .comment');
          
          // Path for different icon types
          const iconPaths = {
               'heart': {
               default: 'resources/Heart.svg',
               clicked: 'resources/Heart-Clicked.svg'
               },
               'heartCrack': {
               default: 'resources/HeartCrack.svg',
               clicked: 'resources/HeartCrack-Clicked.svg'
               },
               'bookmark': {
               default: 'resources/Bookmark.svg',
               clicked: 'resources/Bookmark-Clicked.svg'
               }
          };

          if (iconType === 'heart' || iconType === 'heartCrack') {
               // Find like and dislike buttons
               const likeButton = post.querySelector('.actionButton img[src*="Heart"]').closest('.actionButton');
               const dislikeButton = post.querySelector('.actionButton img[src*="HeartCrack"]').closest('.actionButton');
               
               // Get like and dislike counters
               const likeCounter = likeButton.querySelector('.counter');
               const dislikeCounter = dislikeButton.querySelector('.counter');

               // Determine current button details
               const currentButton = iconType === 'heart' ? likeButton : dislikeButton;
               const otherButton = iconType === 'heart' ? dislikeButton : likeButton;
               const currentImg = currentButton.querySelector('img');
               const otherImg = otherButton.querySelector('img');
               const currentCounter = iconType === 'heart' ? likeCounter : dislikeCounter;
               const otherCounter = iconType === 'heart' ? dislikeCounter : likeCounter;

               // Normalize the current image's src path to ensure comparison works
               const currentSrc = currentImg.src.split('/').pop(); // Extract only the filename
               const isCurrentlyClicked = currentSrc === iconPaths[iconType].clicked.split('/').pop();

               // Check the other button's state
               const otherSrc = otherImg.src.split('/').pop();
               const isOtherClicked = otherSrc === iconPaths[iconType === 'heart' ? 'heartCrack' : 'heart'].clicked.split('/').pop();

               // Toggle current button state
               if (isCurrentlyClicked) {
                    // If already clicked, reset (unlike/undislike)
                    currentImg.src = iconPaths[iconType].default;
                    currentCounter.textContent = Math.max(0, parseInt(currentCounter.textContent) - 1);
               } else {
                    // If not clicked, set current button to clicked state
                    currentImg.src = iconPaths[iconType].clicked;
                    currentCounter.textContent = parseInt(currentCounter.textContent) + 1;

                    // If the other button was clicked, reset it
                    if (isOtherClicked) {
                         otherImg.src = iconPaths[iconType === 'heart' ? 'heartCrack' : 'heart'].default;
                         otherCounter.textContent = Math.max(0, parseInt(otherCounter.textContent) - 1);
                    }
               }
          } else if (iconType === 'bookmark') {
               // Bookmark button logic
               const currentSrc = img.src.split('/').pop(); // Extract only the filename
               const isCurrentlyBookmarked = currentSrc === iconPaths.bookmark.clicked.split('/').pop();

               // Toggle bookmark state
               if (isCurrentlyBookmarked) {
                    img.src = iconPaths.bookmark.default;
               } else {
                    img.src = iconPaths.bookmark.clicked;
               }
          }
     }

     // Get modal elements
    const modal = document.getElementById("imageModal");
    const modalImg = document.getElementById("modalImage");
    const captionText = document.getElementById("caption");
    const closeBtn = document.getElementsByClassName("close")[0];

    // Function to open modal
    function openModal(imgElement) {
        modal.style.display = "block";
        modalImg.src = imgElement.src;
        captionText.innerHTML = imgElement.alt || "";
    }

    // Close modal when clicking (X)
    closeBtn.onclick = function() {
        modal.style.display = "none";
    }

    // Close modal when clicking outside the image
    modal.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === "Escape" && modal.style.display === "block") {
            modal.style.display = "none";
        }
    });

    document.addEventListener('DOMContentLoaded', () => {
        const storedReply = localStorage.getItem('selectedReply');
        if (storedReply) {
        const replyContentDiv = document.getElementById('textContent');
        if (replyContentDiv) {
            replyContentDiv.textContent = storedReply;
        }
        localStorage.removeItem('selectedReply');
        }
    });
</script>